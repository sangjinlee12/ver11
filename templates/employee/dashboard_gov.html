{% extends "base_gov.html" %}

{% block title %}대한민국 행정안전부 - 직원 포털{% endblock %}

{% block content %}
<div class="gov-breadcrumb">
    <a href="{{ url_for('main.dashboard') }}">홈</a>
    <i class="fas fa-chevron-right"></i>
    <span>직원 포털</span>
</div>

<div class="gov-page-header">
    <h1 class="gov-page-title">
        <i class="fas fa-user"></i> {{ current_user.name }}님의 포털
    </h1>
    <p class="gov-page-subtitle">{{ current_user.department }} {{ current_user.position }} | 개인 업무 현황을 확인하고 각종 신청을 진행할 수 있습니다.</p>
</div>

<!-- 개인 현황 카드 -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <!-- 휴가 현황 -->
    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #003d82, #002855); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-calendar-check" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">
                    {{ remaining_vacation_days }}일 / {{ total_vacation_days }}일
                </div>
                <div style="font-size: 13px; opacity: 0.9;">잔여 연차 / 총 연차</div>
            </div>
            <div style="display: flex; gap: 8px;">
                <a href="{{ url_for('employee.request_vacation') }}" class="gov-btn gov-btn-primary" style="flex: 1; font-size: 13px;">
                    <i class="fas fa-plus"></i> 휴가신청
                </a>
                <a href="{{ url_for('employee.my_vacations') }}" class="gov-btn gov-btn-secondary" style="flex: 1; font-size: 13px;">
                    <i class="fas fa-list"></i> 내역조회
                </a>
            </div>
        </div>
    </div>

    <!-- 신청 현황 -->
    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #00b894, #00a085); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-clipboard-list" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 20px; font-weight: 700; margin-bottom: 5px;">
                    {{ pending_requests }}건
                </div>
                <div style="font-size: 13px; opacity: 0.9;">승인 대기 중인 신청</div>
            </div>
            <div style="display: flex; gap: 8px;">
                <a href="{{ url_for('employee.my_vacations') }}" class="gov-btn gov-btn-success" style="flex: 1; font-size: 13px;">
                    <i class="fas fa-search"></i> 진행상황
                </a>
                <a href="{{ url_for('employee.my_certificates') }}" class="gov-btn gov-btn-secondary" style="flex: 1; font-size: 13px;">
                    <i class="fas fa-file"></i> 증명서
                </a>
            </div>
        </div>
    </div>

    <!-- 근무 정보 -->
    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #fdcb6e, #e17055); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-building" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 16px; font-weight: 700; margin-bottom: 5px;">
                    {{ current_user.department }}
                </div>
                <div style="font-size: 13px; opacity: 0.9;">{{ current_user.position }}</div>
            </div>
            <div style="font-size: 13px; color: #6c757d;">
                {% if current_user.hire_date %}
                    입사일: {{ current_user.hire_date.strftime('%Y년 %m월 %d일') }}
                {% else %}
                    입사일: 미등록
                {% endif %}
            </div>
        </div>
    </div>

    <!-- 증명서 발급 -->
    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #6c5ce7, #5f3dc4); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-certificate" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 16px; font-weight: 700; margin-bottom: 5px;">
                    재직증명서
                </div>
                <div style="font-size: 13px; opacity: 0.9;">온라인 즉시 발급</div>
            </div>
            <a href="{{ url_for('employee.request_certificate') }}" class="gov-btn" style="background: #6c5ce7; color: white; width: 100%; font-size: 13px;">
                <i class="fas fa-file-contract"></i> 증명서 신청
            </a>
        </div>
    </div>
</div>

<!-- 최근 활동 및 공지사항 -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
    <!-- 나의 최근 휴가 신청 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <i class="fas fa-clock"></i> 최근 휴가 신청 내역
        </div>
        <div class="gov-card-body">
            {% if recent_my_vacations %}
                <table class="gov-table">
                    <thead>
                        <tr>
                            <th>신청일</th>
                            <th>휴가기간</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vacation in recent_my_vacations %}
                        <tr>
                            <td>{{ vacation.created_at.strftime('%m/%d') }}</td>
                            <td>
                                {{ vacation.start_date.strftime('%m/%d') }} ~ {{ vacation.end_date.strftime('%m/%d') }}<br>
                                <small style="color: #6c757d;">{{ vacation.days }}일 ({{ vacation.type }})</small>
                            </td>
                            <td>
                                {% if vacation.status == '대기중' %}
                                    <span class="gov-badge gov-badge-pending">{{ vacation.status }}</span>
                                {% elif vacation.status == '승인됨' %}
                                    <span class="gov-badge gov-badge-approved">{{ vacation.status }}</span>
                                {% else %}
                                    <span class="gov-badge gov-badge-rejected">{{ vacation.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="{{ url_for('employee.my_vacations') }}" class="gov-btn gov-btn-secondary">
                        <i class="fas fa-list"></i> 전체 내역 보기
                    </a>
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-calendar-plus" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p>아직 휴가 신청 내역이 없습니다.</p>
                    <a href="{{ url_for('employee.request_vacation') }}" class="gov-btn gov-btn-primary" style="margin-top: 10px;">
                        <i class="fas fa-plus"></i> 첫 휴가 신청하기
                    </a>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 공지사항 및 안내 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <i class="fas fa-bullhorn"></i> 공지사항 및 안내
        </div>
        <div class="gov-card-body">
            <div class="gov-alert gov-alert-info" style="margin-bottom: 15px;">
                <strong>2025년도 연차 사용 안내</strong><br>
                <small>연차휴가는 12월 31일까지 사용하셔야 하며, 미사용 시 자동 소멸됩니다.</small>
            </div>
            
            <div class="gov-alert gov-alert-warning" style="margin-bottom: 15px;">
                <strong>온라인 증명서 발급 서비스</strong><br>
                <small>재직증명서는 즉시 온라인으로 발급 가능합니다. 신청 후 승인되면 바로 다운로드할 수 있습니다.</small>
            </div>

            <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid #003d82;">
                <div style="font-size: 14px; font-weight: 600; margin-bottom: 8px; color: #003d82;">
                    <i class="fas fa-phone"></i> 문의처
                </div>
                <div style="font-size: 13px; line-height: 1.6; color: #6c757d;">
                    인사팀: 02-2100-3114 (내선 2234)<br>
                    시스템 문의: 02-2100-1999<br>
                    이메일: hr@mois.go.kr
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 빠른 메뉴 -->
<div class="gov-card">
    <div class="gov-card-header">
        <i class="fas fa-bolt"></i> 빠른 메뉴
    </div>
    <div class="gov-card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <a href="{{ url_for('employee.request_vacation') }}" class="gov-btn gov-btn-primary" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
                <i class="fas fa-calendar-plus" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                <div style="font-weight: 600;">휴가 신청</div>
                <small style="opacity: 0.8;">연차/반차/특별휴가</small>
            </a>

            <a href="{{ url_for('employee.my_vacations') }}" class="gov-btn gov-btn-secondary" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
                <i class="fas fa-list-alt" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                <div style="font-weight: 600;">휴가 내역</div>
                <small style="opacity: 0.8;">신청 현황 및 이력</small>
            </a>

            <a href="{{ url_for('employee.request_certificate') }}" class="gov-btn gov-btn-warning" style="padding: 15px; text-align: center; text-decoration: none; display: block;">
                <i class="fas fa-file-contract" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                <div style="font-weight: 600;">재직증명서</div>
                <small style="opacity: 0.8;">온라인 즉시 발급</small>
            </a>

            <a href="{{ url_for('employee.my_certificates') }}" class="gov-btn" style="background: #6c5ce7; color: white; padding: 15px; text-align: center; text-decoration: none; display: block;">
                <i class="fas fa-download" style="font-size: 20px; margin-bottom: 8px; display: block;"></i>
                <div style="font-weight: 600;">증명서 다운로드</div>
                <small style="opacity: 0.8;">발급된 증명서 확인</small>
            </a>
        </div>
    </div>
</div>

<!-- 휴가 캘린더 미리보기 -->
<div class="gov-card" style="margin-top: 25px;">
    <div class="gov-card-header">
        <i class="fas fa-calendar"></i> 이번 달 휴가 및 공휴일
    </div>
    <div class="gov-card-body">
        {% if upcoming_events %}
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                {% for event in upcoming_events %}
                <div style="background: #f8f9fa; padding: 15px; border-radius: 6px; border-left: 4px solid {% if event.type == 'vacation' %}#003d82{% else %}#dc3545{% endif %};">
                    <div style="font-size: 14px; font-weight: 600; color: {% if event.type == 'vacation' %}#003d82{% else %}#dc3545{% endif %}; margin-bottom: 5px;">
                        {{ event.date.strftime('%m월 %d일 (%a)') }}
                    </div>
                    <div style="font-size: 13px; color: #6c757d;">
                        {% if event.type == 'vacation' %}
                            <i class="fas fa-user"></i> {{ event.description }}
                        {% else %}
                            <i class="fas fa-flag"></i> {{ event.description }}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 30px; color: #6c757d;">
                <i class="fas fa-calendar-day" style="font-size: 32px; margin-bottom: 10px;"></i>
                <p>이번 달에 예정된 휴가나 공휴일이 없습니다.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 실시간 시계
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        const clockElement = document.getElementById('current-time');
        if (clockElement) {
            clockElement.textContent = timeString;
        }
    }
    
    // 페이지 로드 시 시계 업데이트 시작
    document.addEventListener('DOMContentLoaded', function() {
        updateClock();
        setInterval(updateClock, 1000);
    });
</script>
{% endblock %}