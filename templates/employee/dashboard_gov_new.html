{% extends "base_gov.html" %}

{% block title %}에스에스전력 - 직원 포털{% endblock %}

{% block content %}
<div class="gov-breadcrumb">
    <a href="{{ url_for('main.dashboard') }}">홈</a>
    <i class="fas fa-chevron-right"></i>
    <span>직원 포털</span>
</div>

<div class="gov-page-header">
    <h1 class="gov-page-title">
        <i class="fas fa-user"></i> {{ current_user.name }}님의 포털
    </h1>
    <p class="gov-page-subtitle">
        {{ current_user.department }} {{ current_user.position }} | 
        개인 업무 현황을 확인하고 각종 신청을 진행할 수 있습니다.
    </p>
</div>

<!-- 개인 현황 요약 -->
<div class="gov-card">
    <div class="gov-card-header">
        <span><i class="fas fa-chart-pie"></i> 나의 현황</span>
        <small style="color: var(--gov-text-light);">{{ "now"|strftime('%Y년 %m월 %d일 기준') }}</small>
    </div>
    <div class="gov-card-body">
        <div class="gov-grid gov-grid-3">
            <!-- 휴가 현황 -->
            <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, var(--gov-blue-light), #f0f8ff); border-radius: 8px; border: 1px solid var(--gov-border);">
                <div style="background: var(--gov-blue); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 24px;">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div style="font-size: 24px; font-weight: 700; color: var(--gov-blue); margin-bottom: 8px;">
                    {{ remaining_vacation_days }} / {{ total_vacation_days }}일
                </div>
                <div style="font-size: 14px; color: var(--gov-text-light); margin-bottom: 8px;">잔여 연차 / 총 연차</div>
                <!-- 진행 바 -->
                <div style="background: #e9ecef; height: 8px; border-radius: 4px; overflow: hidden;">
                    <div style="background: var(--gov-blue); height: 100%; width: {{ (remaining_vacation_days / total_vacation_days * 100) if total_vacation_days > 0 else 0 }}%; transition: width 0.3s;"></div>
                </div>
            </div>

            <!-- 신청 현황 -->
            <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #d4edda, #c3e6cb); border-radius: 8px; border: 1px solid #c3e6cb;">
                <div style="background: var(--gov-success); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 24px;">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <div style="font-size: 24px; font-weight: 700; color: var(--gov-success); margin-bottom: 8px;">
                    {{ pending_requests }}건
                </div>
                <div style="font-size: 14px; color: var(--gov-text-light);">승인 대기 중인 신청</div>
            </div>

            <!-- 근무 정보 -->
            <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #fff3cd, #ffeaa7); border-radius: 8px; border: 1px solid #ffeaa7;">
                <div style="background: var(--gov-warning); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 24px;">
                    <i class="fas fa-building"></i>
                </div>
                <div style="font-size: 18px; font-weight: 700; color: #856404; margin-bottom: 8px;">
                    {{ current_user.department }}
                </div>
                <div style="font-size: 14px; color: var(--gov-text-light);">
                    {{ current_user.position }}
                    {% if current_user.hire_date %}
                        <br><small>입사: {{ current_user.hire_date.strftime('%Y.%m.%d') }}</small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 빠른 메뉴 -->
<div class="gov-card">
    <div class="gov-card-header">
        <span><i class="fas fa-bolt"></i> 빠른 메뉴</span>
    </div>
    <div class="gov-card-body">
        <div class="gov-grid gov-grid-2">
            <!-- 휴가 관련 -->
            <div style="border: 1px solid var(--gov-border); border-radius: 8px; padding: 20px; background: var(--gov-white);">
                <h3 style="color: var(--gov-blue); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-calendar-plus"></i> 휴가 관리
                </h3>
                <p style="color: var(--gov-text-light); font-size: 14px; margin-bottom: 15px; line-height: 1.5;">
                    휴가 신청, 내역 조회 및 승인 현황을 확인할 수 있습니다.
                </p>
                <div style="display: flex; gap: 8px;">
                    <a href="{{ url_for('employee.request_vacation') }}" class="gov-btn gov-btn-primary" style="flex: 1;">
                        <i class="fas fa-plus"></i> 휴가 신청
                    </a>
                    <a href="{{ url_for('employee.my_vacations') }}" class="gov-btn gov-btn-secondary" style="flex: 1;">
                        <i class="fas fa-list"></i> 내역 조회
                    </a>
                </div>
            </div>

            <!-- 증명서 관련 -->
            <div style="border: 1px solid var(--gov-border); border-radius: 8px; padding: 20px; background: var(--gov-white);">
                <h3 style="color: var(--gov-success); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-file-contract"></i> 증명서 발급
                </h3>
                <p style="color: var(--gov-text-light); font-size: 14px; margin-bottom: 15px; line-height: 1.5;">
                    재직증명서, 경력증명서 등 각종 증명서를 신청할 수 있습니다.
                </p>
                <div style="display: flex; gap: 8px;">
                    <a href="{{ url_for('employee.request_certificate') }}" class="gov-btn gov-btn-success" style="flex: 1;">
                        <i class="fas fa-plus"></i> 증명서 신청
                    </a>
                    <a href="{{ url_for('employee.my_certificates') }}" class="gov-btn gov-btn-secondary" style="flex: 1;">
                        <i class="fas fa-folder-open"></i> 내 증명서
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 활동 내역 -->
<div class="gov-grid gov-grid-2">
    <!-- 최근 휴가 신청 내역 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <span><i class="fas fa-history"></i> 최근 휴가 신청</span>
            <a href="{{ url_for('employee.my_vacations') }}" style="color: var(--gov-blue); font-size: 13px; text-decoration: none;">
                <i class="fas fa-external-link-alt"></i> 전체보기
            </a>
        </div>
        <div class="gov-card-body">
            {% if recent_vacations %}
                <div style="max-height: 320px; overflow-y: auto;">
                    {% for vacation in recent_vacations %}
                    <div style="padding: 15px 0; border-bottom: 1px solid var(--gov-border);">
                        <div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--gov-text); margin-bottom: 4px;">
                                    {{ vacation.start_date.strftime('%Y.%m.%d') }} - {{ vacation.end_date.strftime('%Y.%m.%d') }}
                                </div>
                                <div style="font-size: 13px; color: var(--gov-text-light);">
                                    {{ vacation.days }}일 | {{ vacation.reason or '개인사유' }}
                                </div>
                            </div>
                            <span class="gov-badge gov-badge-{{ 'warning' if vacation.status.value == 'pending' else 'success' if vacation.status.value == 'approved' else 'danger' }}">
                                {{ '대기중' if vacation.status.value == 'pending' else '승인' if vacation.status.value == 'approved' else '반려' }}
                            </span>
                        </div>
                        {% if vacation.status.value == 'rejected' and vacation.rejection_reason %}
                        <div style="font-size: 12px; color: var(--gov-danger); background: #f8d7da; padding: 6px 8px; border-radius: 4px;">
                            반려 사유: {{ vacation.rejection_reason }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; color: var(--gov-text-light);">
                    <i class="fas fa-calendar-plus" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;"></i>
                    <p>아직 휴가 신청 내역이 없습니다.</p>
                    <p style="font-size: 13px;">첫 휴가를 신청해보세요!</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 최근 증명서 신청 내역 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <span><i class="fas fa-file-alt"></i> 최근 증명서 신청</span>
            <a href="{{ url_for('employee.my_certificates') }}" style="color: var(--gov-blue); font-size: 13px; text-decoration: none;">
                <i class="fas fa-external-link-alt"></i> 전체보기
            </a>
        </div>
        <div class="gov-card-body">
            {% if recent_certificates %}
                <div style="max-height: 320px; overflow-y: auto;">
                    {% for cert in recent_certificates %}
                    <div style="padding: 15px 0; border-bottom: 1px solid var(--gov-border);">
                        <div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 8px;">
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: var(--gov-text); margin-bottom: 4px;">
                                    {{ '재직증명서' if cert.certificate_type.value == 'employment' else '경력증명서' if cert.certificate_type.value == 'career' else cert.certificate_type.value }}
                                </div>
                                <div style="font-size: 13px; color: var(--gov-text-light);">
                                    신청일: {{ cert.created_at.strftime('%Y.%m.%d %H:%M') }}
                                </div>
                            </div>
                            <span class="gov-badge gov-badge-{{ 'warning' if cert.status.value == 'pending' else 'success' if cert.status.value == 'completed' else 'danger' }}">
                                {{ '대기중' if cert.status.value == 'pending' else '완료' if cert.status.value == 'completed' else '반려' }}
                            </span>
                        </div>
                        {% if cert.status.value == 'completed' %}
                        <div style="font-size: 12px;">
                            <a href="#" style="color: var(--gov-blue); text-decoration: none;">
                                <i class="fas fa-download"></i> 다운로드
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div style="text-align: center; padding: 40px; color: var(--gov-text-light);">
                    <i class="fas fa-file-contract" style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;"></i>
                    <p>아직 증명서 신청 내역이 없습니다.</p>
                    <p style="font-size: 13px;">필요한 증명서를 신청해보세요!</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- 공지사항 -->
<div class="gov-card">
    <div class="gov-card-header">
        <span><i class="fas fa-bullhorn"></i> 공지사항</span>
    </div>
    <div class="gov-card-body">
        <div class="gov-alert gov-alert-info">
            <i class="fas fa-info-circle"></i>
            <div>
                <strong>시스템 이용 안내</strong><br>
                • 휴가 신청은 최소 3일 전에 해주세요.<br>
                • 증명서 발급은 영업일 기준 1-2일 소요됩니다.<br>
                • 문의사항은 경영지원팀(내선 123)으로 연락주세요.
            </div>
        </div>
    </div>
</div>

<style>
/* 배지 스타일 */
.gov-badge {
    display: inline-block;
    padding: 4px 8px;
    font-size: 12px;
    font-weight: 600;
    border-radius: 4px;
    text-transform: uppercase;
    white-space: nowrap;
}

.gov-badge-warning {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.gov-badge-success {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.gov-badge-danger {
    background: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}
</style>
{% endblock %}