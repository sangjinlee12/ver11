{% extends "base_gov.html" %}

{% block title %}에스에스전력 - 회사 정보 관리{% endblock %}

{% block content %}
<div class="gov-breadcrumb">
    <a href="{{ url_for('main.dashboard') }}">홈</a>
    <i class="fas fa-chevron-right"></i>
    <span>회사 정보 관리</span>
</div>

<div class="gov-page-header">
    <h1 class="gov-page-title">
        <i class="fas fa-building"></i> 회사 정보 관리
    </h1>
    <p class="gov-page-subtitle">재직증명서에 기재될 회사 정보를 관리합니다.</p>
</div>

<!-- 성공 메시지 -->
{% if get_flashed_messages() %}
    <div class="gov-alert gov-alert-success" style="margin-bottom: 20px;">
        <i class="fas fa-check-circle"></i>
        {% for message in get_flashed_messages() %}
            {{ message }}
        {% endfor %}
    </div>
{% endif %}

<!-- 회사 정보 관리 -->
<div class="gov-card">
    <div class="gov-card-header">
        <i class="fas fa-edit"></i> 회사 정보 수정
    </div>
    <div class="gov-card-body">
        <form method="POST" action="{{ url_for('admin.manage_company_info') }}">
            {{ form.hidden_tag() }}
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- 회사명 -->
                <div>
                    <label class="gov-form-label">{{ form.name.label }}</label>
                    {{ form.name(class="gov-form-control") }}
                    {% if form.name.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.name.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 대표자명 -->
                <div>
                    <label class="gov-form-label">{{ form.ceo_name.label }}</label>
                    {{ form.ceo_name(class="gov-form-control") }}
                    {% if form.ceo_name.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.ceo_name.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 사업자등록번호 -->
                <div>
                    <label class="gov-form-label">{{ form.registration_number.label }}</label>
                    {{ form.registration_number(class="gov-form-control") }}
                    {% if form.registration_number.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.registration_number.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 회사 주소 -->
                <div>
                    <label class="gov-form-label">{{ form.address.label }}</label>
                    {{ form.address(class="gov-form-control") }}
                    {% if form.address.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.address.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 전화번호 -->
                <div>
                    <label class="gov-form-label">{{ form.phone.label }}</label>
                    {{ form.phone(class="gov-form-control") }}
                    {% if form.phone.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.phone.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 팩스번호 -->
                <div>
                    <label class="gov-form-label">{{ form.fax.label }}</label>
                    {{ form.fax(class="gov-form-control") }}
                    {% if form.fax.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.fax.errors[0] }}</div>
                    {% endif %}
                </div>
                
                <!-- 웹사이트 -->
                <div>
                    <label class="gov-form-label">{{ form.website.label }}</label>
                    {{ form.website(class="gov-form-control") }}
                    {% if form.website.errors %}
                        <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.website.errors[0] }}</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- 직인 이미지 -->
            <div style="margin-top: 25px;">
                <label class="gov-form-label">{{ form.stamp_image.label }}</label>
                <div style="font-size: 12px; color: #6c757d; margin-bottom: 10px;">
                    직인 이미지를 업로드하거나 base64 형식으로 등록할 수 있습니다. 재직증명서 발급 시 사용됩니다.
                </div>
                
                <!-- 파일 업로드 -->
                <div style="margin-bottom: 15px;">
                    <input type="file" id="stampImageFile" accept="image/*" class="gov-form-control">
                    <button type="button" id="uploadStampBtn" class="gov-btn" style="margin-top: 10px; background: #6c757d; color: white;">
                        <i class="fas fa-upload"></i> 이미지 변환
                    </button>
                </div>
                
                <!-- Base64 텍스트 영역 -->
                {{ form.stamp_image(class="gov-form-control", rows=3, placeholder="base64 형식의 이미지 데이터가 여기에 표시됩니다") }}
                {% if form.stamp_image.errors %}
                    <div style="color: #dc3545; font-size: 12px; margin-top: 5px;">{{ form.stamp_image.errors[0] }}</div>
                {% endif %}
            </div>
            
            <!-- 기존 직인 미리보기 -->
            {% if company_info and company_info.stamp_image %}
            <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px;">
                <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #495057;">현재 등록된 직인</h4>
                <img src="{{ company_info.stamp_image }}" alt="현재 직인" style="max-width: 200px; max-height: 100px; border: 1px solid #ccc;">
            </div>
            {% endif %}
            
            <div style="text-align: right; margin-top: 25px;">
                {{ form.submit(class="gov-btn gov-btn-primary") }}
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('uploadStampBtn').addEventListener('click', function() {
        const fileInput = document.getElementById('stampImageFile');
        const base64Input = document.getElementById('stamp_image');
        
        if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                base64Input.value = e.target.result;
                updatePreview(e.target.result);
            };
            
            reader.readAsDataURL(file);
        } else {
            alert('이미지 파일을 선택해주세요.');
        }
    });
    
    function updatePreview(base64Data) {
        let previewDiv = document.getElementById('stampPreview');
        if (!previewDiv) {
            previewDiv = document.createElement('div');
            previewDiv.id = 'stampPreview';
            previewDiv.style.cssText = 'margin-top: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 6px;';
            document.getElementById('stamp_image').parentNode.appendChild(previewDiv);
        }
        
        previewDiv.innerHTML = `
            <h4 style="font-size: 13px; font-weight: 600; margin-bottom: 10px; color: #495057;">직인 미리보기</h4>
            <img src="${base64Data}" alt="직인 미리보기" style="max-width: 200px; max-height: 100px; border: 1px solid #ccc;">
        `;
    }
</script>
{% endblock %}