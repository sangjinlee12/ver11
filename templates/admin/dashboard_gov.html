{% extends "base_gov.html" %}

{% block title %}대한민국 행정안전부 - 관리자 대시보드{% endblock %}

{% block content %}
<div class="gov-breadcrumb">
    <a href="{{ url_for('routes.dashboard') }}">홈</a>
    <i class="fas fa-chevron-right"></i>
    <span>관리자 대시보드</span>
</div>

<div class="gov-page-header">
    <h1 class="gov-page-title">
        <i class="fas fa-tachometer-alt"></i> 관리자 대시보드
    </h1>
    <p class="gov-page-subtitle">인사관리시스템 전체 현황을 확인하고 관리할 수 있습니다.</p>
</div>

<!-- 주요 통계 카드 -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #003d82, #002855); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-users" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 24px; font-weight: 700;">{{ total_employees }}명</div>
                <div style="font-size: 13px; opacity: 0.9;">전체 직원 수</div>
            </div>
            <a href="{{ url_for('admin.manage_employees') }}" class="gov-btn gov-btn-primary" style="width: 100%;">
                <i class="fas fa-cog"></i> 직원 관리
            </a>
        </div>
    </div>

    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #00b894, #00a085); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-calendar-check" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 24px; font-weight: 700;">{{ pending_vacations }}건</div>
                <div style="font-size: 13px; opacity: 0.9;">승인 대기 휴가</div>
            </div>
            <a href="{{ url_for('admin.manage_vacations') }}" class="gov-btn gov-btn-success" style="width: 100%;">
                <i class="fas fa-tasks"></i> 휴가 관리
            </a>
        </div>
    </div>

    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #fdcb6e, #e17055); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-certificate" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 24px; font-weight: 700;">{{ pending_certificates }}건</div>
                <div style="font-size: 13px; opacity: 0.9;">증명서 발급 대기</div>
            </div>
            <a href="{{ url_for('admin.manage_certificates') }}" class="gov-btn gov-btn-warning" style="width: 100%;">
                <i class="fas fa-file-contract"></i> 증명서 관리
            </a>
        </div>
    </div>

    <div class="gov-card">
        <div class="gov-card-body" style="text-align: center;">
            <div style="background: linear-gradient(135deg, #6c5ce7, #5f3dc4); color: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                <i class="fas fa-calendar-alt" style="font-size: 32px; margin-bottom: 10px;"></i>
                <div style="font-size: 24px; font-weight: 700;">{{ total_holidays }}일</div>
                <div style="font-size: 13px; opacity: 0.9;">등록된 공휴일</div>
            </div>
            <a href="{{ url_for('admin.manage_holidays') }}" class="gov-btn" style="background: #6c5ce7; color: white; width: 100%;">
                <i class="fas fa-calendar-plus"></i> 공휴일 관리
            </a>
        </div>
    </div>
</div>

<!-- 최근 활동 -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px;">
    <!-- 최근 휴가 신청 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <i class="fas fa-clock"></i> 최근 휴가 신청 현황
        </div>
        <div class="gov-card-body">
            {% if recent_vacations %}
                <table class="gov-table">
                    <thead>
                        <tr>
                            <th>신청자</th>
                            <th>기간</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for vacation in recent_vacations %}
                        <tr>
                            <td>
                                <strong>{{ vacation.user.name }}</strong><br>
                                <small style="color: #6c757d;">{{ vacation.user.department }}</small>
                            </td>
                            <td>
                                {{ vacation.start_date.strftime('%m/%d') }} ~ {{ vacation.end_date.strftime('%m/%d') }}<br>
                                <small style="color: #6c757d;">{{ vacation.days }}일</small>
                            </td>
                            <td>
                                {% if vacation.status == '대기중' %}
                                    <span class="gov-badge gov-badge-pending">{{ vacation.status }}</span>
                                {% elif vacation.status == '승인됨' %}
                                    <span class="gov-badge gov-badge-approved">{{ vacation.status }}</span>
                                {% else %}
                                    <span class="gov-badge gov-badge-rejected">{{ vacation.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-inbox" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p>최근 휴가 신청이 없습니다.</p>
                </div>
            {% endif %}
        </div>
    </div>

    <!-- 최근 증명서 신청 -->
    <div class="gov-card">
        <div class="gov-card-header">
            <i class="fas fa-file-alt"></i> 최근 증명서 신청 현황
        </div>
        <div class="gov-card-body">
            {% if recent_certificates %}
                <table class="gov-table">
                    <thead>
                        <tr>
                            <th>신청자</th>
                            <th>용도</th>
                            <th>상태</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cert in recent_certificates %}
                        <tr>
                            <td>
                                <strong>{{ cert.user.name }}</strong><br>
                                <small style="color: #6c757d;">{{ cert.user.department }}</small>
                            </td>
                            <td>
                                {{ cert.purpose[:20] }}{% if cert.purpose|length > 20 %}...{% endif %}
                            </td>
                            <td>
                                {% if cert.status == '대기중' %}
                                    <span class="gov-badge gov-badge-pending">{{ cert.status }}</span>
                                {% elif cert.status == '발급완료' %}
                                    <span class="gov-badge gov-badge-approved">{{ cert.status }}</span>
                                {% else %}
                                    <span class="gov-badge gov-badge-rejected">{{ cert.status }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div style="text-align: center; padding: 40px; color: #6c757d;">
                    <i class="fas fa-inbox" style="font-size: 32px; margin-bottom: 10px;"></i>
                    <p>최근 증명서 신청이 없습니다.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- 부서별 현황 -->
<div class="gov-card">
    <div class="gov-card-header">
        <i class="fas fa-chart-bar"></i> 부서별 인원 현황
    </div>
    <div class="gov-card-body">
        {% if department_stats %}
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                {% for dept, count in department_stats.items() %}
                <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #003d82;">
                    <div style="font-size: 24px; font-weight: 700; color: #003d82; margin-bottom: 5px;">{{ count }}명</div>
                    <div style="font-size: 14px; color: #6c757d;">{{ dept }}</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div style="text-align: center; padding: 40px; color: #6c757d;">
                <i class="fas fa-building" style="font-size: 32px; margin-bottom: 10px;"></i>
                <p>부서별 데이터가 없습니다.</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- 시스템 공지사항 -->
<div class="gov-card" style="margin-top: 25px;">
    <div class="gov-card-header">
        <i class="fas fa-bullhorn"></i> 시스템 공지사항
    </div>
    <div class="gov-card-body">
        <div class="gov-alert gov-alert-info">
            <strong>2025년도 연차휴가 사용 안내</strong><br>
            2025년도 연차휴가는 12월 31일까지 사용하셔야 하며, 미사용 연차는 자동 소멸됩니다.
        </div>
        <div class="gov-alert gov-alert-warning">
            <strong>시스템 정기점검 안내</strong><br>
            매월 마지막 일요일 02:00~04:00 시스템 정기점검이 진행됩니다.
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // 실시간 시계
    function updateClock() {
        const now = new Date();
        const timeString = now.toLocaleString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        const clockElement = document.getElementById('current-time');
        if (clockElement) {
            clockElement.textContent = timeString;
        }
    }
    
    // 페이지 로드 시 시계 업데이트 시작
    document.addEventListener('DOMContentLoaded', function() {
        updateClock();
        setInterval(updateClock, 1000);
    });
</script>
{% endblock %}